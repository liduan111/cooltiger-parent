<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kyj.cooltiger.cooltigeroauth.dao.UserDao">

    <!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="com.kyj.cooltiger.cooltigeroauth.entity.Userpo" id="userMap">
        <result property="userId" column="id"/>
        <result property="userCode" column="usercode"/>
        <result property="username" column="username"/>
        <result property="password" column="password"/>
        <result property="gender" column="gender"/>
        <result property="age" column="age"/>
        <result property="register_time" column="register_time"/>
        <result property="last_login_time" column="last_login_time"/>
        <result property="last_login_ip" column="last_login_ip"/>
        <result property="user_level_id" column="user_level_id"/>
        <result property="nickname" column="nickname"/>
        <result property="mobile" column="mobile"/>
        <result property="register_ip" column="register_ip"/>
        <result property="avatar" column="avatar"/>
        <result property="weixin_openid" column="weixin_openid"/>
        <result property="idCard" column="id_card"/>
        <result property="isReal" column="is_real"/>
        <result property="qrCode" column="qr_code"/>
        <result property="realName" column="real_name"/>
        <result property="registerchannel" column="registerchannel"/>
    </resultMap>

    <select id="queryObject" resultMap="userMap">
        select * from cy_wxuser where id = #{value}
    </select>

    <select id="queryByOpenId" resultMap="userMap">
        select * from cy_wxuser
        where 1 = 1
        <if test="openId != null">
            and `weixin_openid` = #{openId}
        </if>
    </select>

    <select id="queryByuserCode" resultMap="userMap">
        select * from cy_wxuser
        where 1 = 1
        <if test="userCode != null and userCode != 0">
            and `usercode` = #{userCode}
        </if>
    </select>
    <select id="queryList" resultMap="userMap">
        select * from cy_wxuser
        <choose>
            <when test="sidx != null and sidx.trim() != ''">
                order by ${sidx} ${order}
            </when>
            <otherwise>
                order by id desc
            </otherwise>
        </choose>
        <if test="offset != null and limit != null">
            limit #{offset}, #{limit}
        </if>
    </select>

    <select id="queryTotal" resultType="int">
        select count(*) from cy_wxuser
    </select>

    <insert id="save" parameterType="com.kyj.cooltiger.cooltigeroauth.entity.Userpo" useGeneratedKeys="true" keyProperty="userId">
        insert into cy_wxuser
        (
            `usercode`,
            `username`,
            `password`,
            `gender`,
            `age`,
            `register_time`,
            `last_login_time`,
            `last_login_ip`,
            `user_level_id`,
            `nickname`,
            `mobile`,
            `register_ip`,
            `avatar`,
            `weixin_openid`,
            `registerchannel`,
            `qr_code`,
            `real_name`


        )
        values
        (
            #{userCode},
            #{username},
            #{password},
            #{gender},
            #{age},
            #{register_time},
            #{last_login_time},
            #{last_login_ip},
            #{user_level_id},
            #{nickname},
            #{mobile},
            #{register_ip},
            #{avatar},
            #{weixin_openid},
            #{registerchannel},
            #{qrCode},
            #{realName}

        )
    </insert>

    <update id="update" parameterType="com.kyj.cooltiger.cooltigeroauth.entity.Userpo">
        update cy_wxuser
        <set>
            <if test="username != null">`username` = #{username},</if>
            <if test="password != null">`password` = #{password},</if>
            <if test="gender != null">`gender` = #{gender},</if>
            <if test="age != null">`age` = #{age},</if>
            <if test="register_time != null">`register_time` = #{register_time},</if>
            <if test="last_login_time != null">`last_login_time` = #{last_login_time},</if>
            <if test="last_login_ip != null">`last_login_ip` = #{last_login_ip},</if>
            <if test="user_level_id != null">`user_level_id` = #{user_level_id},</if>
            <if test="nickname != null">`nickname` = #{nickname},</if>
            <if test="mobile != null">`mobile` = #{mobile},</if>
            <if test="register_ip != null">`register_ip` = #{register_ip},</if>
            <if test="avatar != null">`avatar` = #{avatar},</if>
            <if test="weixin_openid != null">`weixin_openid` = #{weixin_openid},</if>
            <if test="idCard != null">`id_card` = #{idCard},</if>
            <if test="registerchannel != null">`registerchannel` = #{registerchannel},</if>
            <if test="isReal != null">`is_real` = #{isReal},</if>
            <if test="qrCode != null">`qr_code` = #{qrCode},</if>
            <if test="realName != null">`real_name` = #{realName}</if>

        </set>
        where id = #{userId}
    </update>

    <update id="updatelogintime" parameterType="com.kyj.cooltiger.cooltigeroauth.entity.Userpo">
        update cy_wxuser
        <set>
            <if test="last_login_time != null">`last_login_time` = #{last_login_time},</if>
            <if test="last_login_ip != null">`last_login_ip` = #{last_login_ip},</if>
        </set>
        where usercode = #{userCode}
    </update>
    <update id="updateUserInfo" parameterType="com.kyj.cooltiger.cooltigeroauth.entity.Userpo">
        update cy_wxuser
        <set>
            <if test="username != null">`username` = #{username},</if>
            <if test="gender != null">`gender` = #{gender},</if>
            <if test="age != null">`age` = #{age},</if>
            <if test="nickname != null">`nickname` = #{nickname},</if>
            <if test="mobile != null">`mobile` = #{mobile},</if>
            <if test="avatar != null">`avatar` = #{avatar},</if>
            <if test="realName != null">`real_name` = #{realName}</if>
        </set>
        where usercode = #{userCode}
    </update>
    <!-- 可根据自己的需求，是否要使用 -->
    <!--<resultMap type="com.platform.entity.SmsLogVo" id="smslogMap">
        <result property="id" column="id"/>
        <result property="user_id" column="user_id"/>
        <result property="phone" column="phone"/>
        <result property="log_date" column="log_date"/>
        <result property="sms_code" column="sms_code"/>
        <result property="send_status" column="send_status"/>
        <result property="sms_text" column="sms_text"/>
    </resultMap>-->

    <!--<select id="querySmsCodeByUserId" resultMap="smslogMap">
        select
            a.id,
            a.user_id,
            a.phone,
            a.log_date,
            a.sms_code,
            a.send_status,
            a.sms_text
        from nideshop_sms_log a
                 left join nideshop_sms_log b on a.user_id = b.user_id and b.log_date > a.log_date
        where a.user_id = #{user_id} and b.id is null
    </select>

    <insert id="saveSmsCodeLog" parameterType="com.platform.entity.SmsLogVo">
        insert into nideshop_sms_log(
            `id`,
            `user_id`,
            `phone`,
            `log_date`,
            `sms_code`,
            `send_status`,
            `sms_text`)
        values(
                  #{id},
                  #{user_id},
                  #{phone},
                  #{log_date},
                  #{sms_code},
                  #{send_status},
                  #{sms_text}
              )
    </insert>-->
</mapper>